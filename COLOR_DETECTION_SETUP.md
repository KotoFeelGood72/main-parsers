# Настройка определения цвета автомобиля

Сервис автоматически определяет цвет автомобиля по фотографии, если цвет не указан в объявлении.

## Быстрый старт (рекомендуется)

Самый простой способ - использовать встроенный анализ изображений:

```bash
npm install sharp
```

Готово! Определение цвета будет работать автоматически при парсинге.

## Доступные варианты (все бесплатные)

### 1. Hugging Face Inference API (Рекомендуется)
- **Бесплатно**: до 1000 запросов/месяц
- **Точность**: Высокая
- **Настройка**: 
  1. Зарегистрируйтесь на https://huggingface.co
  2. Создайте API токен: https://huggingface.co/settings/tokens
  3. Добавьте в `.env`:
     ```
     COLOR_DETECTION_PROVIDER=huggingface
     HUGGINGFACE_API_KEY=ваш_токен
     ```

### 2. Google Vision API
- **Бесплатно**: до 1000 запросов/месяц
- **Точность**: Высокая
- **Настройка**:
  1. Создайте проект в Google Cloud Console
  2. Включите Vision API
  3. Создайте API ключ
  4. Добавьте в `.env`:
     ```
     COLOR_DETECTION_PROVIDER=google
     GOOGLE_VISION_API_KEY=ваш_ключ
     ```

### 3. Простое определение (Sharp) - Рекомендуется для начала
- **Бесплатно**: Полностью бесплатно, без лимитов и API ключей
- **Точность**: Средняя-Хорошая (зависит от качества фото)
- **Настройка**:
  1. Установите библиотеку sharp:
     ```bash
     npm install sharp
     ```
  2. Добавьте в `.env` (или оставьте по умолчанию):
     ```
     COLOR_DETECTION_PROVIDER=simple
     ```
  
  **Это самый простой вариант для начала** - не требует регистрации и API ключей!

## Как это работает

1. При парсинге объявления система проверяет, указан ли цвет
2. Если цвет не указан или равен "Неизвестно", система пытается определить его по фотографиям
3. Используется главное изображение или первое доступное фото
4. Определенный цвет автоматически сохраняется в базу данных

## Приоритет провайдеров

Если указан `COLOR_DETECTION_PROVIDER`, используется указанный провайдер. Если определение не удалось, система автоматически пробует другие доступные провайдеры (если у них есть API ключи).

## Пример использования

Определение цвета происходит автоматически при сохранении данных в базу. Никаких дополнительных действий не требуется.

Если нужно определить цвет вручную:

```javascript
const { colorDetectionService } = require('./src/services/ColorDetectionService');

// Определение по одному изображению
const color = await colorDetectionService.detectColor('https://example.com/car.jpg');

// Определение по нескольким изображениям
const color = await colorDetectionService.detectColorFromImages([
    'https://example.com/car1.jpg',
    'https://example.com/car2.jpg'
]);
```

## Поддерживаемые цвета

- Белый
- Черный
- Серебристый
- Серый
- Красный
- Синий
- Зеленый
- Желтый
- Оранжевый
- Коричневый
- Бежевый
- Золотой
- Бронзовый
- Фиолетовый
- Розовый

Если цвет не определен, возвращается "Неизвестно".
